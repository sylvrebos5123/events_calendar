<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="robots" content="noindex, nofollow">
  <meta name="googlebot" content="noindex, nofollow">


	<link href='../fullcalendar.css' rel='stylesheet' />
	<link href='../fullcalendar.print.css' rel='stylesheet' media='print' />

	<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <script src='../lib/jquery.min.js'></script>
    <script src='../lib/moment.min.js'></script>
    <script src="./js/bootstrap.min.js"></script>
    <script src='../fullcalendar.min.js'></script>

  <style type="text/css">
  
	body {
		margin: 40px 10px;
		padding: 0;
		font-family: "Lucida Grande",Helvetica,Arial,Verdana,sans-serif;
		font-size: 14px;
	}
	
    #calendar {
		max-width: 900px;
		margin: 0 auto;
	}


  </style>

  <title>Bootstrap and Fullcalendar module by SV</title>


<script type='text/javascript'>//<![CDATA[
$(window).load(function(){
$(document).ready(function() {

	 $('#calendar').fullCalendar({
      defaultView: 'agendaWeek',
        timezone: 'UTC',
        editable: false,
        selectable: true,
        timeFormat: 'H:mm',

		events: {

		url: 'php/file_test.php',
			error: function() {
				$('#script-warning').show();
			}
		},
         eventClick: function(event) {

             starttime=moment(event.start).format('YYYY-MM-DDTHH:mm:ss');
             endtime=moment(event.end).format('YYYY-MM-DDTHH:mm:ss');

             var mywhen = starttime + ' - ' + endtime;
             //alert(mywhen);
             var split_starttime=starttime.split('T');
             var split_endtime=endtime.split('T');
             var split_title=event.title.split('-');
             $('h4.modal-title').html('Edit Event');
             $('#formEvent #id_event').val(event.id);
             $('#formEvent #event_title').val(split_title[0]);
             $('#formEvent #event_place').val(split_title[1]);
             $('#formEvent #start_date').val(split_starttime[0]);
             $('#formEvent #start_time').val(split_starttime[1]);
             $('#formEvent #end_date').val(split_endtime[0]);
             $('#formEvent #end_time').val(split_endtime[1]);
             $('#formEvent #deleteButton').show();

             $('#formEvent').modal('show');

         },
      //header and other values
      select: function(start, end) {

		starttime=moment(start).format('YYYY-MM-DDTHH:mm:ss'); 
        endtime=moment(end).format('YYYY-MM-DDTHH:mm:ss'); 
          //var mywhen = starttime + ' - ' + endtime;
          var split_starttime=starttime.split('T');
          var split_endtime=endtime.split('T');

          $('h4.modal-title').html('Create Event');
          $('#formEvent #id_event').val(0);
          $('#formEvent #start_date').val(split_starttime[0]);
          $('#formEvent #start_time').val(split_starttime[1]);
          $('#formEvent #end_date').val(split_endtime[0]);
          $('#formEvent #end_time').val(split_endtime[1]);

          $('#formEvent #deleteButton').hide();
          $('#formEvent').modal('show');
       }
    });

  $('#submitButton').on('click', function(e){
    // We don't want this to act as a link so cancel the link action
    e.preventDefault();

    doSubmit();
  });

  function doSubmit(){

    $("#formEvent").modal('hide');

    if($('#start_time').val()=='00:00:00')
    {

        startDateTime = moment($('#start_date').val()).format('YYYY-MM-DD');
    }
    else
    {
        startDateTime = moment($('#start_date').val()+' '+$('#start_time').val()).format('YYYY-MM-DDTHH:mm:ss');
    }
////////
    if($('#end_time').val()=='00:00:00')
    {
      endDateTime = moment($('#end_date').val()).format('YYYY-MM-DD');
    }
    else
    {
      endDateTime = moment($('#end_date').val() + ' ' + $('#end_time').val()).format('YYYY-MM-DDTHH:mm:ss');
    }


    if(($('#end_time').val()=='00:00:00')&&($('#start_time').val()=='00:00:00'))
    {
        dayFlag=true;
    }
      else
    {
        dayFlag=false;
    }

    //alert(startDateTime);
    //alert(endDateTime);
     // alert($('#id_event').val());
     $.ajax({
              method: "GET",
              url: "php/add_event.php",
              data: {
                  id_event: parseInt($('#id_event').val()),
                  event_title: $('#event_title').val(),
                  event_place: $('#event_place').val(),
                  start_date_time: startDateTime,
                  end_date_time: endDateTime
              }/*,
             beforeSend: function(){
                 $("#loaderDiv").show();

             },
             success: function(data)
             {   $('#calendar').fullCalendar( 'refetchEvents' );


             }*/
          })

          .done(function( msg ) {
              //alert( "Data Saved " + msg );
              $("#loaderDiv").hide();
          });


   }
});
});

</script>

  
</head>

<body>
  <div id="loaderDiv" style="background-color: #cd0a0a;">Loading ...</div>
  <div id="calendar"></div>

  
<div class="modal fade" id="formEvent" role="dialog">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title"></h4>
        </div>
        <div class="modal-body">
          <!-- form -->
		  <form id="createAppointmentForm" class="form-horizontal" action="php/add_event.php" method="post">
              <div class="form-group row">
                <input type="hidden" id="apptAllDay" >
                  <input type="hidden" id="id_event" name="id_event" >
                <label class="col-sm-2" for="inputevent_title">Title:</label>
                <div class="col-sm-10">
                    <input type="text" name="event_title" id="event_title" class="form-control">
                </div>
              </div>
              <div class="form-group row">
                <label class="col-sm-2" for="inputevent_place">Place:</label>
                <div class="col-sm-10">
                    <input type="text" name="event_place" id="event_place" class="form-control">
                </div>
              </div>
              <div class="form-group">

                <label class="col-sm-2" for="when">When:</label>
                <div class="col-sm-3">
                    <input type="date"  id="start_date" name="start_date" value="" class="form-control">
                </div>
                <div class="col-sm-2">
                    <input type="time" id="start_time" name="start_time" class="form-control">
                </div>
              <br></br>

                    <div class="col-sm-offset-2 col-sm-3">
                        <input type="date" id="end_date" name="end_date" class="form-control">
                    </div>
                    <div class="col-sm-2">
                        <input type="time" id="end_time" name="end_time" class="form-control">
                    </div>
			</div>
		</form>
		 <!-- form -->
        </div>
        <div class="modal-footer">
		  <button class="btn btn-default" data-dismiss="modal" >Cancel</button>
          <button type="submit" class="btn btn-primary" id="submitButton">Save</button>
            <button type="submit" class="btn btn-danger" id="deleteButton">Delete this event</button>
        </div>
      </div>
    </div>
</div>

  
</body>

</html>

